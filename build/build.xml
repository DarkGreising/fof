<?xml version="1.0" encoding="UTF-8"?>
<project name="FrameworkOnFramework" description="Framework-on-Framework for Joomla!" default="all" >
	<import file="${phing.dir}/../../buildfiles/phing/common.xml" />

	<property name="dirs.strapper" value="../strapper" />

	<!--
	====================================================================================================
	Tasks - General
	====================================================================================================
	-->
	
	<target name="git" description="Makes only the library package"
		depends="new-release,setup-properties,library-package">
	</target>
	
	<target name="documentation" description="Creates the documentation packages"
		depends="doc-pdf">
	</target>

	<!--
	====================================================================================================
	Tasks - Joomla! packages
	====================================================================================================
	-->
	
	<target name="library-package" description="FOF Installation Package for Joomla! 1.6+"
		depends="new-release,setup-properties">

		<!-- Generate files_strapper.xml and version.php for Akeeba Strapper -->
		<copy todir="${dirs.root}" overwrite="true">
			<fileset dir="./templates">
				<include name="strapper/**" />
			</fileset>
			<filterchain>
				<replacetokens begintoken="##" endtoken="##">
					<token key="DATE" value="${git.date}" />
					<token key="VERSION" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>

		<!-- Generate XML file for FOF -->
		<copy file="./templates/lib_f0f.xml" tofile="${dirs.root}/lib_f0f.xml" overwrite="true">
			<filterchain>
				<replacetokens begintoken="##" endtoken="##">
					<token key="DATE" value="${git.date}" />
					<token key="VERSION" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>
		<copy file="${dirs.root}/lib_f0f.xml" tofile="${dirs.library}/lib_f0f.xml" overwrite="true" />

		<!-- Generate version.txt file for FOF -->
		<copy file="./templates/version.txt" tofile="${dirs.library}/version.txt" overwrite="true">
			<filterchain>
				<replacetokens begintoken="##" endtoken="##">
					<token key="DATE" value="${git.date}" />
					<token key="VERSION" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>
		<!-- Generate version.txt file for Akeeba Strapper -->
		<copy file="./templates/version.txt" tofile="${dirs.strapper}/version.txt" overwrite="true">
			<filterchain>
				<replacetokens begintoken="##" endtoken="##">
					<token key="DATE" value="${git.date}" />
					<token key="VERSION" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>

		<!-- Generate include file for FOF -->
		<copy file="./templates/include.php" tofile="${dirs.library}/include.php" overwrite="true">
			<filterchain>
				<replacetokens begintoken="##" endtoken="##">
					<token key="DATE" value="${git.date}" />
					<token key="VERSION" value="${version}" />
				</replacetokens>
			</filterchain>
		</copy>

		<!-- Create the package -->
		<zipme basedir="${dirs.library}" prefix="fof/" destfile="${dirs.release}/lib_fof-${version}.zip" includeemptydirs="true">
			<fileset dir="${dirs.library}" id="library">
				<include name="**" />
			</fileset>
		</zipme>
		<zipme basedir="${dirs.root}" destfile="${dirs.release}/lib_fof-${version}.zip" includeemptydirs="true">
			<fileset dir="${dirs.root}">
				<include name="lib_f0f.xml" />
			</fileset>
		</zipme>

		<!-- Clean up -->
		<delete>
			<fileset dir="${dirs.root}">
				<include name="lib_f0f.xml" />
			</fileset>
		</delete>
	</target>
	
	<!--
	====================================================================================================
	Tasks - Documentation
	====================================================================================================
	-->
	
	<target name="doc-pdf" description="Documentation in PDF format">
		<phingcall target="docbook-pdf">
			<property name="docs.input" value="fof-guide.xml" />
		</phingcall>
	</target>
	
    <target name="doc-epub" description="Documentation in ePub format">
		<phingcall target="docbook-epub">
			<property name="docs.input" value="fof-guide.xml" />
		</phingcall>
    </target>

	<!--
	====================================================================================================
	Tasks - Project management
	====================================================================================================
	-->
	<target name="docsdeploy" depends="docsdeploy-fofguide">
		<echo>All FOF documentation has been uploaded</echo>
	</target>

	<target name="docsdeploy-fofguide" >
		<phingcall target="docbook-deploy">
			<property name="docsdeploy.path.source" value="" />
			<property name="docsdeploy.path.target" value="fof" />
		</phingcall>
	</target>

</project>